<!DOCTYPE html>
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<html>
  <style>
    .upload-button {
  position: relative;
  overflow: hidden;
  display: inline-block;
}



.upload-button  {
  background-color: #01579B;
  color: #fff;
  padding: 5px 10px; 
  border-radius: 20px;
  margin-top: 10px;
  margin-bottom: 10px;

  border: none;
  border-radius: 5px;
  cursor:pointer;
  ;
}

.upload-button:hover {
  background-color: #559af5;
  cursor: pointer;
  ;
}




.add-button {
  position: relative;
  overflow: hidden;
  display: inline-block;
}



.add-button  {
  background-color: #12ec19;
  color: #fff;
  padding: 5px 10px; 
  border-radius: 20px;
  margin-top: 10px;
  margin-bottom: 10px;

  border: none;
  border-radius: 5px;
  ;
}

.add-button:hover {
  background-color: rgb(37, 97, 9);
  cursor:pointer ;
  ;
}




     .top-bar {
        background-color: #01579B;
        color: #FFFFFF;
        padding: 5px;
        margin-top: auto;
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-left: auto;
        margin-right: auto;
    }

    .top-bar .title {
        font-size: 2rem;
        margin-left: 290px;
        font-weight: 600;
    }
    .top-bar .icons {
    display: flex;
    margin-top: 5px;
    margin-bottom: 5px;
    margin-right: 20px;
    align-items: center;
    gap: 2rem;
}


    .top-bar .icons img {
        width: 2rem;
        height: 2rem;
        border-radius: 50%;
        transition: background-color 0.3s ease-in-out, transform 0.3s ease-in-out;
        cursor: pointer;
    }

    .top-bar .icons img:hover {
        transform: scale(1.3);
    }

 

    .top-bar .icons .notification {
        position: relative;
    }

    .top-bar .icons .notification span {
        position: absolute;
        top: 0;
        right: 0;
        width: 1rem;
        height: 1rem;
        background-color: #0dff00;
        border-radius: 50%;
    }

    .sidebar {
  position: fixed;
  top: 0;
  bottom: 0;
  left: 0;
  width: 260px;
  background-color: #2C384A;
  color: #FFFFFF;
  padding: 1rem;
  display: flex;
  flex-direction: column;
  align-items: center;
  overflow-y: auto;
  scrollbar-width: thin; /* for Firefox */
  -ms-overflow-style: -ms-autohiding-scrollbar; /* for IE and Edge */
}

.sidebar .logo {
  font-size: 1.3rem;
  font-weight: 600;
  margin-bottom: 1rem;
}

.sidebar img {
  width: 170px;
  margin-bottom: 1rem;
}

.sidebar nav {
  flex-grow: 1;
  margin-top: 2rem;
}

.sidebar nav a {
  display: flex;
  align-items: center;
  padding: 0.3rem 0.3rem;
  color: #FFFFFF;
  text-decoration: none;
  transition: background-color 0.3s ease-in-out;
}

.sidebar nav a:hover {
  color: #79aefd;
}

.sidebar nav a img {
  width: 40px;
  height: 40px;
  margin-right: 1rem;
  margin-top: 20px;
}

.sidebar nav a span {
  font-size: 1rem;
  font-weight: 500;
}

    .main-content {
        margin-left: 260px;
        padding-left: 40px;
        padding-right: 20px;
        padding-bottom: 70px;
        margin-top: 1px;
    }

    .card {
        background-color: #FFFFFF;
        padding: 1rem;
        border: 1px solid #CCCCCC;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    .card h2 {
        margin-top: 0;
    }

    #chatheadsnotif {
    transition: transform 0.3s ease-in-out;
  }

  #chatheadsnotif:hover {
    transform: scale(1.2);
  }

  #chatheadsnotif.expanded {
    transform: scale(1.5);
  }

  #chatheadsnotif.expanded #chatheads {
    width: 80px;
    height: 80px;
  }

  #chatheadsnotif.expanded .absolute {
    bottom: -10px;
    right: -10px;
  }
    
  </style>
<style>
  #book-icon {
  transition: transform 0.5s; /* add transition effect */
}

#book-icon:hover {
  transform: scale(1.1); /* scale up by 10% on hover */
}

body {
  overflow: -moz-scrollbars-none;
  -ms-overflow-style: none;
}

:root {
  scrollbar-width: none !important;
}




.search-bar {
  width: 300px;
  position: absolute;
  top: 50; /* changed to 0 to make it on top */
  left: 50%;
  transform: translateX(-50%);
  z-index: 3; /* added to make it on top of everything */
}

#search-input {
  flex: 2;
  width: 400px;
  padding: 10px;
  color: black;
  font-size: 12px;
  border: none;
  border-radius: 10px 10px 10px 10px;
}




.suggestions {
  position: absolute;
  top: 35px;
  background-color: #f9f9f9;
  border: 1px solid #ccc;
  padding: 10px;
  width: 400px;
  display: none;
  color: black;
  z-index: 3; /* added to make it on top of everything */
  overflow-y: auto; /* add this */
  max-height: 350px; /* or a fixed height */
}

.suggestions ul {
list-style: none;
  padding: 0;
  margin: 0;
}
.element {
  transition: all 0.5 s ease;
}
.suggestions li {
  padding: 10px;
  border-bottom: 1px solid #ccc;
  display: flex;
  align-items: center;
}

.suggestion-photo {
  width: 30px;
  height: 30px;
  margin-right: 10px;
  border-radius: 50%;
}

.suggestions li:hover {
  background-color: #d1cfcf;
  cursor: pointer;
}

#search-input:focus + .suggestions {
  display: block;
}


#studentDetails {
  display: flex;
  flex-direction: column; /* Align items vertically */
}

#studentDetails label {
  margin-bottom: 5px; /* Add spacing between labels and inputs */
}

#studentDetails input {
  margin-bottom: 2px; /* Add spacing between input fields */
  padding: 2px; /* Optional: Add padding to inputs for better appearance */
}





.notification-panel {
  transform: translateX(100%);
  transition: transform 0.3s ease-in-out;
}

.notification-panel.show {
  transform: translateX(0);
}

.close-button {
  cursor: pointer;
}




.sidebar nav a1 {
        display: flex;
        align-items: center;
        padding: 0.3rem 0.3rem;
        color: #79aefd;
        text-decoration: none;
        transition: background-color 0.3s ease-in-out;
    }
    .status-orb {
  display: inline-block;
  width: 10px;
  height: 10px;
  border-radius: 50%;
  margin-right: 5px;
}

.red-orb {
  background-color: red;
}

.green-orb {
  background-color: green;
}

    
   
#studentDetails p {
    color: white;
}

    
    .sidebar nav a1:hover{
      color: #79aefd;
    }

    .sidebar nav a1 img {
        width: 40px;
        height: 40px;
        margin-right: 1rem;
        margin-top: 20px;
    }
   
    .sidebar nav a1 span {
        font-size: 1rem;
        font-weight: 500;
    }

    table {
  border-collapse: collapse;
  width: 100%;
  margin-top: 50px;
}

th, td {
  border: 1px solid #000000;
  padding: 8px;
  text-align: left;
}

th {
  background-color: #01579B;
  color:white;
  text-align: center;
  cursor: d;
}

tr:nth-child(even) {
  background-color: #f9f9f9;
}

tr:hover {
  background-color: #ddd;
  cursor: pointer;
}

.border-b-2 {
  border-bottom: 2px solid #ddd;
}

.p-2 {
  padding: 0.5rem;
}

.filter-box {
  border: 1px solid #ddd;
  padding: 10px;
  border-radius: 5px;
  background-color: #f9f9f9;
}
 </style>

<style>
  .filter-container {
      display: flex;
      gap: 20px; /* Space between filters */
      align-items: center; /* Center items vertically */
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      background-color: #f8f9fa;
  }
  .filter-container label {
      margin-right: 8px;
      font-weight: bold;
  }
  .filter-container select {
      padding: 5px 10px;
      border-radius: 4px;
      border: 1px solid #ced4da;
      background-color: #fff;
  }
  .filter-container select:focus {
      border-color: #80bdff;
      outline: 0;
  }
  .grid-cols-2 {
  display: grid;
  grid-template-columns: 1fr 2fr; /* 1 part label, 2 parts input */
  gap: 10px;
}
input {
  width: 100%; /* Ensures inputs take full space */
  padding: 8px;
  border: 1px solid #ccc;
  border-radius: 5px;
}
</style>
<head>
    
  </head>
  <div class="sidebar">
    <div class="logo">STI VIGAN E-LIBRARY</div>
    <img src="../image/sti logo 4 (2).png" alt="STI Logo" />
    <nav>
      <a  href="/dashboard2.html">
          <img src="../image/home.png" alt="Others Icon" />
          <span>Dashboard</span>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M19 9l-7 7-7-7"/>
          </svg>
      </a>
      <a href="/catalog.html">
          <img src="../image/catalog.png" alt="Others Icon" />
          <span>Catalogs</span>
         
      </a>
      <a href="/archive.html">
        <img src="../image/catalog.png" alt="Others Icon" />
        <span>Archive </span>
       
    </a>
      <a1 href="/StudentsUploading.html">
        <img src="../image/user (1).png" alt="Others Icon" />
        <span>Students</span>
       
    </a1>
    
     
      
      <a href="#" id="logoutbutton">
        <img src="../image/logout.png"  />
        <span>Log-out</span>

      
    </a>
  </nav>
</div>

  <body>  
    <div class="top-bar">
      <div class="title">Students</div>
      <div class="search-bar">
        <input id="search-input" type="text" placeholder="Search..." autocomplete="off" >
       
      </div>
      
      <div class="icons">
       
        
        
        <div class="notification">
        </div>
      
      </div>
    </div>
   
   

    

    <div class="fixed bottom-0 w-full bg-zinc-900 py-2 px-4 flex justify-end items-center">
    </div>

    <!--This is the main content-->
    <div class="main-content">
      <html>
        <head>
          <meta charset="UTF-8">
          <meta name="viewport" content="width=device-width, initial-scale=1.0">
          <script src="https://cdn.tailwindcss.com"></script>
        </head>
      </html>
      
      <div style="display: flex; gap: 10px;">
        <div>
            <input type="file" id="file-input" style="display: none;">
            <label class="upload-button" id="updateMembers">Update Students</label>
        </div>
        
        <div>
            <input type="file" id="file-input" style="display: none;">
            <label class="add-button"    id="add-studentbutton">Add Student</label>
        </div>
    </div>
    
      
      
      
      
    
      
      <table class="w-full text-left">
        <thead>
          <tr>
           
              
            </th>

            <th class="border-b-2 p-2">ID Number</th>
            <th class="border-b-2 p-2">Name</th>
            <th class="border-b-2 p-2">Account</th>
            <th class="border-b-2 p-2">Program</th>
            <th class="border-b-2 p-2">Level</th>
            <th class="border-b-2 p-2">Status</th>

          </tr>
        </thead>
        <tbody id="table-body">
          <!-- Table rows will be inserted dynamically -->
        </tbody>
      </table>
      
      
          </div>
            
          
     



    
         
    


              
    </body>




 




<!-- Search-->
<div id="yeseditInfo" style="display:none">
  <div class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50">
    <div class="bg-white dark:bg-zinc-800 rounded-lg shadow-lg w-full sm:w-2/3 max-w-4xl p-6">
      <div class="flex justify-between items-center border-b border-blue-200 pb-2">
        <h2 class="text-white text-lg font-semibold">Edit Information</h2>
        <button class="text-white hover:text-gray-300" id="yeseditInfocancel2">×</button>
      </div>

      <div class="flex items-center py-4">
        <img aria-hidden="true" alt="alert icon" src="/image/pen.png" height="80px" width="50px" class="rounded-full mr-4" crossorigin="anonymous">
        <div>
          <h3 class="text-lg font-semibold text-white" id="clickedRowtoShowonEdit">Edit</h3>
          <div id="studentDetails">
            <div class="grid grid-cols-2 gap-4">
              <label class="text-lg font-bold text-black" for="firstName">First Name:</label>
              <input class="text-black p-2 border rounded w-full" type="text" id="firstName" value="" />
          
              <label class="text-lg font-bold text-white" for="middleName">Middle Name:</label>
              <input class="text-black p-2 border rounded w-full" type="text" id="middleName" value="" />
          
              <label class="text-lg font-bold text-white" for="lastName">Last Name:</label>
              <input class="text-black p-2 border rounded w-full" type="text" id="lastName" value="" />
          
              <label class="text-lg font-bold text-white" for="idNumber">ID Number:</label>
              <input class="text-black p-2 border rounded w-full" type="text" id="idNumber" value="" />
          
              <label class="text-lg font-bold text-white" for="email">Account:</label>
              <input class="text-black p-2 border rounded w-full" type="text" id="email" value="" />
          
              <label class="text-lg font-bold text-white" for="gradeProgram">Program:</label>
              <input class="text-black p-2 border rounded w-full" type="text" id="gradeProgram" value="" />
          
              <label class="text-lg font-bold text-white" for="level">Year Level:</label>
              <input class="text-black p-2 border rounded w-full" type="text" id="level" value="" />
          
              <label class="text-lg font-bold text-white" for="status">Access:</label>
              <input class="text-black p-2 border rounded w-full" type="text" id="status" value="" />
          
              <label class="text-lg font-bold text-white" for="datetime">Date Added:</label>
              <span class="text-white" id="datetime"></span>
            </div>
          </div>
          
        </div>
      </div>

      <div class="flex justify-end space-x-2 mt-4">
        <button id="editToggleButton" class="bg-yellow-600 text-white rounded-lg py-2 px-4">Edit</button>
        <button class="bg-blue-600 text-white rounded-lg py-2 px-4 hidden" id="ifYeseditInfo">Save</button>
        <button class="bg-red-600 text-white rounded-lg py-2 px-4" id="archiveButton">Archive</button>
        <button class="bg-gray-600 text-white rounded-lg py-2 px-4" id="yeseditInfocancel">Cancel</button>
      </div>
    </div>
  </div>
</div>




<div id="addStudentModal" style="display:none">
  <div class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50">
    <div class="bg-white dark:bg-zinc-800 rounded-lg shadow-lg w-11/12 sm:w-96 p-4 grid grid-cols-12 gap-6">
      <!-- Modal Header -->
      <div class="col-span-12 flex justify-between items-center border-b border-red-200 pb-2">
        <h2 class="text-red-600 dark:text-red-400 text-lg font-semibold">Add Student</h2>
        <button class="text-zinc-600 dark:text-zinc-400 hover:text-zinc-800 dark:hover:text-zinc-200" id="closeModal">×</button>
      </div>

      <!-- Modal Content -->
      <form id="addStudentForm" class="col-span-12">
        <div class="grid grid-cols-6 gap-6">
          <!-- Left Side -->
          <div class="col-span-6 sm:col-span-3">
            <label for="idNumber" class="block text-sm font-medium text-zinc-600 dark:text-zinc-300">ID Number:</label>
            <input type="text" id="idNumber" name="idNumber" class="mt-1 block w-full p-2 border border-zinc-300 dark:border-zinc-600 rounded-lg" required>

            <label for="firstname" class="block text-sm font-medium text-zinc-600 dark:text-zinc-300 mt-4">First Name:</label>
            <input type="text" id="firstname" name="firstname" class="mt-1 block w-full p-2 border border-zinc-300 dark:border-zinc-600 rounded-lg" required>

            <label for="middlename" class="block text-sm font-medium text-zinc-600 dark:text-zinc-300 mt-4">Middle Name:</label>
            <input type="text" id="middlename" name="middlename" class="mt-1 block w-full p-2 border border-zinc-300 dark:border-zinc-600 rounded-lg">

            <label for="lastname" class="block text-sm font-medium text-zinc-600 dark:text-zinc-300 mt-4">Last Name:</label>
            <input type="text" id="lastname" name="lastname" class="mt-1 block w-full p-2 border border-zinc-300 dark:border-zinc-600 rounded-lg" required>
          </div>

          <!-- Right Side -->
          <div class="col-span-6 sm:col-span-3">
            <label for="gradeProgram" class="block text-sm font-medium text-zinc-600 dark:text-zinc-300">Grade Program:</label>
            <input type="text" id="gradeProgram" name="gradeProgram" class="mt-1 block w-full p-2 border border-zinc-300 dark:border-zinc-600 rounded-lg" required>

            <label for="level" class="block text-sm font-medium text-zinc-600 dark:text-zinc-300 mt-4">Level:</label>
            <input type="text" id="level" name="level" class="mt-1 block w-full p-2 border border-zinc-300 dark:border-zinc-600 rounded-lg" required>

            <label for="email" class="block text-sm font-medium text-zinc-600 dark:text-zinc-300 mt-4">Email:</label>
            <input type="email" id="email" name="email" class="mt-1 block w-full p-2 border border-zinc-300 dark:border-zinc-600 rounded-lg" required>
          </div>
        </div>

        <!-- Modal Footer -->
        <div class="flex justify-end space-x-2 mt-4">
          <button type="button" id="cancelBtn" class="bg-white dark:bg-zinc-700 text-zinc-800 dark:text-zinc-300 border border-zinc-300 dark:border-zinc-600 rounded-lg py-2 px-4">Cancel</button>
          <button type="submit" class="bg-red-600 text-white rounded-lg py-2 px-4">Add Student</button>
        </div>
      </form>
    </div>
  </div>
</div>







  <div id="logout"  style="display:none">

    <div class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50">
    <div class="bg-white dark:bg-zinc-800 rounded-lg shadow-lg w-11/12 sm:w-96 p-4">
        <div class="flex justify-between items-center border-b border-red-200 pb-2">
            <h2 class="text-red-600 dark:text-red-400 text-lg font-semibold">Log out</h2>
            <button class="text-zinc-600 dark:text-zinc-400 hover:text-zinc-800 dark:hover:text-zinc-200" id="changepassword"   >×</button>
        </div>
        <div class="flex items-center py-4">
            <img aria-hidden="true" alt="alert icon" src="../image/set-of-error-icon-information-logo-illustration-vector.png" height="80px" width="80px" class="rounded-full mr-4  " crossorigin="anonymous">
            <div>
                <h3 class="text-lg font-semibold text-red-600 dark:text-red-400">Are You Sure you want to logout?</h3>
                <p class="text-zinc-600 dark:text-zinc-300"></p>
            </div>
        </div>
        <div class="flex justify-end space-x-2 mt-4">
          <button  class="bg-white dark:bg-zinc-700 text-zinc-800 dark:text-zinc-300 border border-zinc-300 dark:border-zinc-600 rounded-lg py-2 px-4"  id="changepassword1"    >Cancel</button>
          <button class="bg-red-600 text-white rounded-lg py-2 px-4" id="confirm-logout" >Log me out</button>
          </div>
    </div>
</div>
</div>


<div id="addMembers" style="display:none"  >

  <div class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50">
  <div class="bg-white dark:bg-zinc-800 rounded-lg shadow-lg w-11/12 sm:w-400 p-4">
      <div class="flex justify-between items-center border-b border-red-200 pb-2">
          <h2 class="text-red-600 dark:text-blue-400 text-lg font-semibold">How to Upload?</h2>
          <button class="text-zinc-600 dark:text-zinc-400 hover:text-zinc-800 dark:hover:text-zinc-200" id="closeAddMembers"   >×</button>
      </div>
      <div class="flex items-center py-4">
          <img aria-hidden="true" alt="alert icon" src="/image/HOW2.jpg" height="1200px" width="900px"     crossorigin="anonymous">
          <div>
            <h3 class="text-lg font-semibold text-blue-600 dark:text-blue-400 text-center ml-20">Use CSV File to upload</h3>
            <p class="text-zinc-600 dark:text-zinc-300 text ml-20">- Make Space on a First ROW</p>
            <p class="text-zinc-600 dark:text-zinc-300 ml-20">- Student ID on a First COLUMN,Start at the Number 2 Example:(2000123456) </p>
            <p class="text-zinc-600 dark:text-zinc-300 ml-20">- Last Name on a Second COLUMN</p>
            <p class="text-zinc-600 dark:text-zinc-300 ml-20">- First Name on a Third COLUMN</p>
            <p class="text-zinc-600 dark:text-zinc-300 ml-20">- Middle Name on a Fourth COLUMN</p>
            <p class="text-zinc-600 dark:text-zinc-300 ml-20">- Program on a Fifth COLUMN </p>
            <p class="text-zinc-600 dark:text-zinc-300 ml-20">- Level on a Sixth COLUMN</p>
            <p class="text-zinc-600 dark:text-zinc-300 ml-20">- Campus Email Address on a Sixth COLUMN, Example:(carlos.123456@vigan.sti.edu.ph)</p>
            <p class="text-zinc-600 dark:text-zinc-300 text ml-20">- The upload is automatically Update every Students</p>







          </div>
      </div>
      <div class="flex justify-end space-x-2 mt-4">
        <button  class="bg-white dark:bg-zinc-700 text-zinc-800 dark:text-zinc-300 border border-zinc-300 dark:border-zinc-600 rounded-lg py-2 px-4"  id="closeAddMembers1"    >Cancel</button>
        <button class="bg-blue-600 text-white rounded-lg py-2 px-4" id="uploadCSV" >Upload CSV File</button>
        </div>
  </div>
</div>
</div>

<!--sidebar Notification-->
<div class="fixed top-0 right-0 flex items-center justify-center bg-white notification-panel" id="notification-panel">
  <div class="bg-card rounded-lg shadow-lg p-6 w-80">
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-lg font-semibold text-foreground">Notifications</h2>
      <button class="text-muted-foreground hover:text-muted close-button" id="close-button">×</button>
    </div>
    <div class="space-y-4">
      <div class="bg-white p-4 rounded-lg shadow-md">
        <h3 class="font-semibold">Text</h3>
        <p class="text-muted-foreground">Descriptions</p>
      </div>
      
    </div>
  </div>
</div>


  







<!-- Search-->

<!-- Firebase Function-->
 
<script src="https://cdn.firebase.com/libs/firebasejs/9.6.1/firebase-app.js" defer></script>
      <script src="https://cdn.firebase.com/libs/firebasejs/9.6.1/firebase-auth.js" defer></script>
      <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.1/firebase-app.js";
        import { getFirestore, collection, onSnapshot, getDocs, query, where,orderBy, limit, setDoc,doc,deleteDoc,updateDoc,getDoc,addDoc} from "https://www.gstatic.com/firebasejs/9.1.1/firebase-firestore.js";
        import { getStorage, ref, getDownloadURL,} from "https://www.gstatic.com/firebasejs/9.1.1/firebase-storage.js";
        import {getAuth, getAuth as getAuthInstance, sendEmailVerification } from "https://www.gstatic.com/firebasejs/9.1.1/firebase-auth.js";
        import { signInWithEmailAndPassword ,onAuthStateChanged,signOut,createUserWithEmailAndPassword,deleteUser, deleteUser as deleteAuthUser} from "https://www.gstatic.com/firebasejs/9.1.1/firebase-auth.js";


const firebaseConfig = {
  apiKey: "AIzaSyCbWyVqhZdWL5tGF5Y2YXRpY5PJLC0ee6M",
  authDomain: "elibrarylogin-3d7e6.firebaseapp.com",
  projectId: "elibrarylogin-3d7e6",
  storageBucket: "elibrarylogin-3d7e6.appspot.com",
  messagingSenderId: "872832392728",
  appId: "1:872832392728:web:10489984713141407ded6d"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

        //logoutbutton on dashboard
     // Select the logout button and the modal
const logoutButton = document.getElementById('logoutbutton'); // assume this is the ID of the logout button
const logoutModal = document.getElementById('logout');

// Add an event listener to the logout button
logoutButton.addEventListener('click', function() {
    // Toggle the display property of the modal
    logoutModal.style.display = 'block'; // show the modal
});

// Add an event listener to the cancel button
document.getElementById('changepassword').addEventListener('click', function() {
    // Toggle the display property of the modal
    logoutModal.style.display = 'none'; // hide the modal
});


document.getElementById('changepassword1').addEventListener('click', function() {
    // Toggle the display property of the modal
    logoutModal.style.display = 'none'; // hide the modal
});

document.getElementById('confirm-logout').addEventListener('click', function() {
    signOut(auth).then(() => {
        // Clear browser history to prevent back button navigation
        window.location.href = '/logoutloading.html'; // Redirect to login page
        history.pushState(null, null, window.location.href); 
        window.onpopstate = function () {
            history.go(1);
        };
    }).catch((error) => {
        console.error('Error signing out:', error);
        alert('Error signing out. Please try again.');
    });
});

const auth = getAuth();

onAuthStateChanged(auth, (user) => {
    if (!user) {
        // User is not signed in, redirect to login page
        window.location.href = '/index.html'; // Redirect to login page
    }
});


  //logoutbutton on pop up
  


//search function


//notification function 
const notificationBell = document.getElementById('notificationbell');
const notificationPanel = document.getElementById('notification-panel');
const closeButton = document.getElementById('close-button');



const usersRef = collection(db, 'users');
const tbody = document.querySelector('tbody');
const searchInput = document.getElementById('search-input');
let selectedStudentId = null;

onSnapshot(usersRef, async (snapshot) => {
  tbody.innerHTML = '';

  const sortedDocs = snapshot.docs.sort((a, b) => {
    const fullnameA = `${a.data().lastname} ${a.data().firstname} ${a.data().middlename}`.toLowerCase();
    const fullnameB = `${b.data().lastname} ${b.data().firstname} ${b.data().middlename}`.toLowerCase();
    return fullnameA.localeCompare(fullnameB);
  });

  sortedDocs.forEach((doc) => {
    const student = doc.data();
    const studentId = doc.id;

    let currentStatus = student.currentStatus || 'Offline';
    let orbClass = currentStatus === 'Offline' ? 'red-orb' : 'green-orb';
    let orb = `<span class="status-orb ${orbClass}"></span>`;

    let row = `
      <tr data-student-id="${studentId}" class="clickable-row">
          <td class="p-2">${student.idNumber}</td>
          <td class="p-2">${student.lastname}, ${student.firstname} ${student.middlename || ''}</td>
          <td class="p-2">${student.email}</td>
          <td class="p-2">${student.gradeProgram}</td>
          <td class="p-2">${student.level}</td>
          <td class="p-2">${orb} ${currentStatus}</td>
      </tr>
    `;
    tbody.innerHTML += row;
  });


// Firestore reference for the 'archiveStudents' collection
const archiveStudentsRef = collection(db, 'archiveStudents');

// Add click event listener to rows
const rows = document.querySelectorAll('.clickable-row');
let selectedStudentId = null;

// Populate modal with student data
rows.forEach((row) => {
  row.addEventListener('click', () => {
    const studentId = row.getAttribute('data-student-id');
    const doc = sortedDocs.find((doc) => doc.id === studentId);

    if (doc) {
      const student = doc.data();
      selectedStudentId = studentId;

      // Show student details (read-only)
      document.getElementById('clickedRowtoShowonEdit').textContent = `${student.lastname}, ${student.firstname} ${student.middlename || ''}`;
      document.getElementById('studentDetails').innerHTML = `
    <p style="color: white;"><strong>First Name:</strong> <span id="firstName">${student.firstname || ''}</span></p>
    <p style="color: white;"><strong>Middle Name:</strong> <span id="middleName">${student.middlename || ''}</span></p>
    <p style="color: white;"><strong>Last Name:</strong> <span id="lastName">${student.lastname || ''}</span></p>
    <p style="color: white;"><strong>ID Number:</strong> <span id="idNumber">${student.idNumber || ''}</span></p>
    <p style="color: white;"><strong>Email:</strong> <span id="email">${student.email || ''}</span></p>
    <p style="color: white;"><strong>Program:</strong> <span id="gradeProgram">${student.gradeProgram || ''}</span></p>
    <p style="color: white;"><strong>Year Level:</strong> <span id="level">${student.level || ''}</span></p>
    <p style="color: white;"><strong>Access:</strong> <span id="status">${student.status || ''}</span></p>
    <p style="color: white;"><strong>Date Added:</strong> ${student.datetime}</p>
`;


      document.getElementById('yeseditInfo').style.display = 'block';
    }
  });
});

// Toggle between "Edit" mode and "View" mode
document.getElementById('editToggleButton').addEventListener('click', function () {
  const isEditing = this.textContent === "Edit";

  if (isEditing) {
    // Convert text into input fields
    document.querySelectorAll('#studentDetails span').forEach(span => {
      const id = span.id;
      const value = span.textContent.trim();
      span.outerHTML = `<input class="text-black border border-gray-800 p-1" type="text" id="${id}" value="${value}" />`;
    });

    this.textContent = "Cancel Edit";
    document.getElementById('ifYeseditInfo').classList.remove('hidden'); // Show Save button
  } else {
    // Cancel edit, revert to text
    document.getElementById('studentDetails').querySelectorAll('input').forEach(input => {
      const id = input.id;
      const value = input.value;
      input.outerHTML = `<span id="${id}">${value}</span>`;
    });

    this.textContent = "Edit";
    document.getElementById('ifYeseditInfo').classList.add('hidden'); // Hide Save button
  }
});

// Save changes
document.getElementById('ifYeseditInfo').addEventListener('click', async () => {
  if (selectedStudentId) {
    const studentDocRef = doc(usersRef, selectedStudentId);

    // Get updated values
    const updatedData = {
      firstname: document.getElementById('firstName').value,
      middlename: document.getElementById('middleName').value,
      lastname: document.getElementById('lastName').value,
      idNumber: document.getElementById('idNumber').value,
      email: document.getElementById('email').value,
      gradeProgram: document.getElementById('gradeProgram').value,
      level: document.getElementById('level').value,
      status: document.getElementById('status').value,
    };

    // Update Firestore
    await updateDoc(studentDocRef, updatedData);

    // Revert to View mode
    document.getElementById('editToggleButton').textContent = "Edit";
    document.getElementById('ifYeseditInfo').classList.add('hidden');

    // Close modal
    document.getElementById('yeseditInfo').style.display = 'none';
  }
});

// Close pop-up on cancel
document.getElementById('yeseditInfocancel').addEventListener('click', function () {
  document.getElementById('yeseditInfo').style.display = 'none';
});
document.getElementById('yeseditInfocancel2').addEventListener('click', function () {
  document.getElementById('yeseditInfo').style.display = 'none';
});
});


/////////////////////////////////////////////////////////////////////////////////////////////
// Search filter
searchInput.addEventListener('input', (e) => {
  const searchTerm = e.target.value.toLowerCase();
  const rows = tbody.rows;

  for (let i = 0; i < rows.length; i++) {
    const row = rows[i];
    const cells = row.cells;
    let match = false;
    for (let j = 0; j < cells.length; j++) {
      const cell = cells[j];
      const cellText = cell.textContent.toLowerCase();
      if (cellText.includes(searchTerm)) {
        match = true;
        break;
      }
    }
    row.style.display = match ? '' : 'none';
  }
});




//search function // // // // // // // //





// Open Update Members
document.getElementById("updateMembers").addEventListener("click", function() {
  document.getElementById("addMembers").style.display = "block";
});

// Close modal of update Member
document.getElementById("closeAddMembers").addEventListener("click", function() {
  // Only hide the modal without interrupting the upload process
  document.getElementById("addMembers").style.display = "none";
});

// Ensure the file upload finishes before closing the modal
document.getElementById("closeAddMembers1").addEventListener("click", function() {
  // Only hide the modal if the file upload is complete
  if (!isFileUploading) {
    document.getElementById("addMembers").style.display = "none";
  }
});

// Helper variable to track if the file is being uploaded
let isFileUploading = false;

document.getElementById('uploadCSV').addEventListener('click', async () => {
  const fileInput = document.createElement('input');
  fileInput.type = 'file';
  fileInput.accept = '.csv';

  fileInput.addEventListener('change', async (e) => {
    const file = fileInput.files[0];
    const reader = new FileReader();

    // Set the uploading flag to true when file starts reading
    isFileUploading = true;

    reader.onload = async (event) => {
      const csvData = event.target.result;
      const rows = csvData.split('\n').map(row => row.trim()).filter(row => row.length > 0);
      const usersToCreate = [];
      const csvUsersSet = new Set(); // Track users from the CSV

      // Start processing from the second row (index 1)
      for (let i = 1; i < rows.length; i++) {
        const row = rows[i].split(',');
        const cleanRow = row.map(cell => cell.replace(/^"|"$/g, '').trim());
        console.log(`Processing row ${i + 1}:`, cleanRow);

        if (cleanRow.length >= 7) {
          const idNumber = cleanRow[0]; // Column A: idNumber
          const lastname = cleanRow[1] || '';  // Column B: lastname, leave blank if missing
          const firstname = cleanRow[2] || ''; // Column C: firstname, leave blank if missing
          const middlename = cleanRow[3] || ''; // Column D: middlename, leave blank if missing
          const gradeProgram = cleanRow[4]; // Column E: gradeProgram
          const level = cleanRow[5]; // Column F: Level
          const email = cleanRow[6]; // Column G: email

          console.log(`Extracted idNumber: "${idNumber}"`);
          console.log(`Extracted email: "${email}"`);

          if (!email) {
            console.error(`Email is empty for user "${firstname} ${middlename} ${lastname}" in row ${i + 1}`);
            continue;
          }

          if (isValidEmail(email)) {
            csvUsersSet.add(email);
            const user = {
              idNumber,
              firstname,
              middlename,
              lastname,
              email,
              gradeProgram,
              level,
            };
            usersToCreate.push(user);
          } else {
            console.error(`Invalid email format: "${email}" for user "${firstname} ${middlename} ${lastname}" in row ${i + 1}`);
          }
        } else {
          console.error(`Incomplete data in row ${i + 1}:`, cleanRow);
        }
      }

      // Fetch existing users from Firestore
      const existingUsers = await fetchExistingUsers();
      const existingUserEmails = new Set(existingUsers.map(user => user.email));

      // Process deletion - Update status to "Unnapprove" for users not in the CSV
      for (const user of existingUsers) {
        if (!csvUsersSet.has(user.email)) {
          // User not in CSV, update status to "Unnapprove"
          await updateUserStatusInFirestore(user.uid, "Inactive");
        }
      }

      // Proceed with user creation or updates (Approved users from CSV)
      for (const user of usersToCreate) {
        try {
          const auth = getAuth();
          const password = user.idNumber; // Use idNumber as the password

          // Check if user already exists in Firebase Authentication
          let userCredential;
          try {
            userCredential = await createUserWithEmailAndPassword(auth, user.email, password);
            console.log('User created:', userCredential.user.uid);
          } catch (error) {
            if (error.code === 'auth/email-already-in-use') {
              // User already exists, get the user
              const userRecord = await getAuth().getUserByEmail(user.email);
              userCredential = { user: { uid: userRecord.uid } };
              console.log(`User already exists in Authentication: ${user.email}`);
            } else {
              throw error;
            }
          }

          // Check if user exists in Firestore
          const db = getFirestore();
          const userRef = doc(db, 'users', userCredential.user.uid);
          const userDoc = await getDoc(userRef);

          if (userDoc.exists()) {
            // Update user data in Firestore if already exists
            await updateUserStatusInFirestore(userCredential.user.uid, "Approve");
            await createUserInFirestore(userCredential.user.uid, user);
            console.log(`User ${user.email} updated in Firestore.`);
          } else {
            // Add user data to Firestore if not exists
            await createUserInFirestore(userCredential.user.uid, user);
          }

        } catch (error) {
          console.error(`Error creating/updating user "${user.firstname} ${user.middlename} ${user.lastname}":`, error);
        }
      }

      // Hide the addMembers element after processing
      document.getElementById("addMembers").style.display = "none";

      // Set the uploading flag to false after the process is completed
      isFileUploading = false;
    };

    reader.onerror = (error) => {
      console.error('Error reading file:', error);
    };

    reader.readAsText(file);
  });

  fileInput.click();
});


// Open modal
document.getElementById("add-studentbutton").addEventListener("click", function () {
  document.getElementById("addStudentModal").style.display = "flex";
});

// Close modal
document.getElementById("closeModal").addEventListener("click", function () {
  document.getElementById("addStudentModal").style.display = "none";
});

document.getElementById("cancelBtn").addEventListener("click", function () {
  document.getElementById("addStudentModal").style.display = "none";
});
// Handle form submission
document.getElementById("addStudentForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  const idNumber = document.getElementById("idNumber").value.trim();
  const firstname = document.getElementById("firstname").value.trim();
  const middlename = document.getElementById("middlename").value.trim() || "";
  const lastname = document.getElementById("lastname").value.trim();
  const gradeProgram = document.getElementById("gradeProgram").value.trim();
  const level = document.getElementById("level").value.trim();
  const email = document.getElementById("email").value.trim();

  if (!isValidEmail(email)) {
    alert("Invalid email format");
    return;
  }

  // Current DateTime in desired format
  const datetime = new Date().toLocaleString("en-US", {
    weekday: "long", year: "numeric", month: "long", day: "numeric",
    hour: "numeric", minute: "numeric", second: "numeric", hour12: true
  });

  const user = { 
    idNumber, 
    firstname, 
    middlename, 
    lastname, 
    email, 
    gradeProgram, 
    level, 
    status: "Approve", 
    datetime, 
    loggingFirstTime: true 
  };

  try {
    const password = idNumber; // Use idNumber as the password
    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
    const uid = userCredential.user.uid;

    // Add user data to Firestore
    const userRef = doc(db, "users", uid);
    await setDoc(userRef, user);

    alert("User added successfully!");
    document.getElementById("addStudentModal").style.display = "none";
  } catch (error) {
    if (error.code === "auth/email-already-in-use") {
      alert("Email already in use. Please try another.");
    } else {
      alert("Error adding user: " + error.message);
    }
    console.error("Error adding user:", error);
  }
});

// Helper function to validate email format
function isValidEmail(email) {
  const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  return regex.test(email);
}


  </script>
<script>
 function filterTable() {
  // Get filter values
  const statusFilter = document.getElementById('status-filter').value.toLowerCase();
  const programFilter = document.getElementById('program-filter').value.toLowerCase();
  const tableBody = document.getElementById('table-body');
  const rows = tableBody.getElementsByTagName('tr');

  // Loop through rows and apply filters
  for (let i = 0; i < rows.length; i++) {
    const cells = rows[i].getElementsByTagName('td');
    if (cells.length < 7) continue; // Skip rows that don't have enough cells

    // Adjust cell indexes based on your table structure
    const program = cells[4].textContent.trim().toLowerCase();
    const status = cells[6].textContent.trim().toLowerCase();

    // Determine if the row matches the filter criteria
    const statusMatch = (statusFilter === 'all') || (status === statusFilter);
    const programMatch = (programFilter === 'all') || (program === programFilter);

    // Show or hide row based on match results
    if (statusMatch && programMatch) {
      rows[i].style.display = '';
    } else {
      rows[i].style.display = 'none';
    }
  }

  // Ensure that checkboxes reflect the correct state
  document.querySelectorAll('.student-checkbox').forEach(checkbox => {
    const row = checkbox.closest('tr');
    const studentId = row.getAttribute('data-student-id');
    checkbox.checked = checkedStudentIds.has(studentId);
  });
}

</script>



</body>
</html>