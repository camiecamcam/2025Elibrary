<!DOCTYPE html>
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<html>
  <style>
    .top-bar {
       background-color: #01579B;
       color: #FFFFFF;
       padding: 5px;
       margin-top: auto;
       display: flex;
       justify-content: space-between;
       align-items: center;
       margin-left: auto;
       margin-right: auto;
   }

   .top-bar .title {
       font-size: 2rem;
       margin-left: 290px;
       font-weight: 600;
   }
   .top-bar .icons {
   display: flex;
   margin-top: 5px;
   margin-bottom: 5px;
   margin-right: 20px;
   align-items: center;
   gap: 2rem;
}


   .top-bar .icons img {
       width: 2rem;
       height: 2rem;
       border-radius: 50%;
       transition: background-color 0.3s ease-in-out, transform 0.3s ease-in-out;
       cursor: pointer;
   }

   .top-bar .icons img:hover {
       transform: scale(1.3);
   }



   .top-bar .icons .notification {
       position: relative;
   }

   .top-bar .icons .notification span {
       position: absolute;
       top: 0;
       right: 0;
       width: 1rem;
       height: 1rem;
       background-color: #0dff00;
       border-radius: 50%;
   }

   .sidebar {
 position: fixed;
 top: 0;
 bottom: 0;
 left: 0;
 width: 260px;
 background-color: #2C384A;
 color: #FFFFFF;
 padding: 1rem;
 display: flex;
 flex-direction: column;
 align-items: center;
 overflow-y: auto;
 scrollbar-width: thin; /* for Firefox */
 -ms-overflow-style: -ms-autohiding-scrollbar; /* for IE and Edge */
}

.sidebar .logo {
 font-size: 1.3rem;
 font-weight: 600;
 margin-bottom: 1rem;
}

.sidebar img {
 width: 170px;
 margin-bottom: 1rem;
}

.sidebar nav {
 flex-grow: 1;
 margin-top: 2rem;
}

.sidebar nav a {
 display: flex;
 align-items: center;
 padding: 0.3rem 0.3rem;
 color: #FFFFFF;
 text-decoration: none;
 transition: background-color 0.3s ease-in-out;
}

.sidebar nav a:hover {
 color: #79aefd;
}

.sidebar nav a img {
 width: 40px;
 height: 40px;
 margin-right: 1rem;
 margin-top: 20px;
}

.sidebar nav a span {
 font-size: 1rem;
 font-weight: 500;
}

   .main-content {
       margin-left: 260px;
       padding-left: 40px;
       padding-right: 20px;
       padding-bottom: 70px;
       margin-top: 1px;
   }

   .card {
       background-color: #FFFFFF;
       padding: 1rem;
       border: 1px solid #CCCCCC;
       border-radius: 10px;
       box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
   }

   .card h2 {
       margin-top: 0;
   }

   #chatheadsnotif {
   transition: transform 0.3s ease-in-out;
 }

 #chatheadsnotif:hover {
   transform: scale(1.2);
 }

 #chatheadsnotif.expanded {
   transform: scale(1.5);
 }

 #chatheadsnotif.expanded #chatheads {
   width: 80px;
   height: 80px;
 }

 #chatheadsnotif.expanded .absolute {
   bottom: -10px;
   right: -10px;
 }
   
 </style>
<style>
 #book-icon {
 transition: transform 0.5s; /* add transition effect */
}

#book-icon:hover {
 transform: scale(1.1); /* scale up by 10% on hover */
}

body {
 overflow: -moz-scrollbars-none;
 -ms-overflow-style: none;
}

:root {
 scrollbar-width: none !important;
}




.search-bar {
 width: 300px;
 position: absolute;
 top: 50; /* changed to 0 to make it on top */
 left: 50%;
 transform: translateX(-50%);
 z-index: 3; /* added to make it on top of everything */
}

#search-input {
 flex: 2;
 width: 400px;
 padding: 10px;
 color: black;
 font-size: 12px;
 border: none;
 border-radius: 10px 10px 10px 10px;
}




.suggestions {
 position: absolute;
 top: 35px;
 background-color: #f9f9f9;
 border: 1px solid #ccc;
 padding: 10px;
 width: 400px;
 display: none;
 color: black;
 z-index: 3; /* added to make it on top of everything */
 overflow-y: auto; /* add this */
 max-height: 350px; /* or a fixed height */
}

.suggestions ul {
list-style: none;
 padding: 0;
 margin: 0;
}
.element {
 transition: all 0.5 s ease;
}
.suggestions li {
 padding: 10px;
 border-bottom: 1px solid #ccc;
 display: flex;
 align-items: center;
}

.suggestion-photo {
 width: 30px;
 height: 30px;
 margin-right: 10px;
 border-radius: 50%;
}

.suggestions li:hover {
 background-color: #d1cfcf;
 cursor: pointer;
}

#search-input:focus + .suggestions {
 display: block;
}




.notification-panel {
 transform: translateX(100%);
 transition: transform 0.3s ease-in-out;
}

.notification-panel.show {
 transform: translateX(0);
}

.close-button {
 cursor: pointer;
}




.sidebar nav a1 {
       display: flex;
       align-items: center;
       padding: 0.3rem 0.3rem;
       color: #79aefd;
       text-decoration: none;
       transition: background-color 0.3s ease-in-out;
   }
  
   
  
   

   
   .sidebar nav a1:hover{
     color: #79aefd;
   }

   .sidebar nav a1 img {
       width: 40px;
       height: 40px;
       margin-right: 1rem;
       margin-top: 20px;
   }
  
   .sidebar nav a1 span {
       font-size: 1rem;
       font-weight: 500;
   }

   table {
 border-collapse: collapse;
 width: 100%;
 margin-top: 50px;
}

th, td {
 border: 1px solid #000000;
 padding: 8px;
 text-align: left;
}

th {
 background-color: #01579B;
 color:white;
 text-align: center;
 cursor: d;
}

tr:nth-child(even) {
 background-color: #f9f9f9;
}

tr:hover {
 background-color: #ddd;
 cursor: pointer;
}

.border-b-2 {
 border-bottom: 2px solid #ddd;
}

.p-2 {
 padding: 0.5rem;
}
</style>

<head>
    
  </head>
  <div class="sidebar">
    <div class="logo">STI VIGAN E-LIBRARY</div>
    <img src="../image/sti logo 4 (2).png" alt="STI Logo" />
    <nav>
      <a  href="/dashboard2.html">
          <img src="../image/home.png" alt="Others Icon" />
          <span>Dashboard</span>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M19 9l-7 7-7-7"/>
          </svg>
      </a>
      <a href="/catalog.html">
          <img src="../image/catalog.png" alt="Others Icon" />
          <span>Catalogs</span>

         
      </a>

      <a href="/archive.html">
        <img src="../image/catalog.png" alt="Others Icon" />
        <span>Archive </span>
       
    </a>Fu
      <a1 href="/students.html">
        <img src="../image/user (1).png" alt="Others Icon" />
        <span>Students</span>
       
    </a1>
    
     
      <a href="#" id="logoutbutton">
        <img src="../image/logout.png"  />
        <span>Log-out</span>

      
    </a>
  </nav>  
</div>

  <body>  
    <div class="top-bar">
      <div class="title">Students</div>
      <div class="search-bar">
        <input id="search-input" type="text" placeholder="Search..." autocomplete="off" >
        <div class="suggestions">
          <ul>
            <!--BOOKS-->
            <p id="booksCollectiones"><b>Books</b></p>
            <li>
              <img id="books1" src="../image/icons8-books-48.png" alt="photo" class="suggestion-photo">
              <span id="book1-name"></span>
            </li>          
            <li>
              <img id="books2" src="../image/icons8-books-48.png" alt="photo" class="suggestion-photo">
              <span id="book2-name"></span>
            </li>   
            <li>
              <img id="books3" src="../image/icons8-books-48.png" alt="photo" class="suggestion-photo">
              <span id="book3-name"></span>
            </li>   
            <!--sTUDENTS-->
            <p id="studentCollectiones"><b>Students</b></p>
            <li>
              <img id="users1" src="../image/student.png" alt="photo" class="suggestion-photo">
              <span id="user1-name"></span>
            </li>   
            <li>
              <img id="users2" src="../image/student.png" alt="photo" class="suggestion-photo">
              <span id="user2-name"></span>
            </li>   
            <li>
              <img id="users3" src="../image/student.png" alt="photo" class="suggestion-photo">
              <span id="user3-name"></span>
            </li>
            <!--teachers-->
            <p id="teachersCollectiones"><b>Faculty</b></p>
            <li>
              <img id="teachers1" src="../image/teacher.png" alt="photo" class="suggestion-photo">
              <span id="teachers1-name"></span>
            </li>   
            <li>
              <img id="teachers2" src="../image/teacher.png" alt="photo" class="suggestion-photo">
              <span id="teachers2-name"></span>
            </li>   
            <li>
              <img id="teachers3" src="../image/teacher.png" alt="photo" class="suggestion-photo">
              <span id="teachers3-name"></span>
            </li>
          </ul>
        </div>
      </div>
      
      <div class="icons">
       
        
        
        <img  id="notificationbell"   src="../image/notification-bell-icon-free-vector.png" alt="search" />
        <div class="notification">
          <img src="../image/YH5TFCE1QY-preview.png" alt="profile" />
        </div>
      
      </div>
    </div>
   
   

    

    <div class="fixed bottom-0 w-full bg-zinc-900 py-2 px-4 flex justify-end items-center">
    </div>

    <!--This is the main content-->
    <div class="main-content">
      <html>
        <head>
          <meta charset="UTF-8">
          <meta name="viewport" content="width=device-width, initial-scale=1.0">
          <script src="https://cdn.tailwindcss.com"></script>
        </head>
      </html>


      
      <input type="file" id="csv-file" style="display: none;">
            <table class="w-full text-left">
              <thead>
                <tr>
                  <th class="border-b-2 p-2">ID Number</th>
                  <th class="border-b-2 p-2">Name</th>
                  <th class="border-b-2 p-2"   >Program</th>
                  <th class="border-b-2 p-2"    >Level</th>
      
                  <th class="border-b-2 p-2">Account</th>
                  
                  <th class="border-b-2 p-2"> Status</th>
      
                  
                </tr>
              </thead>
              <tbody id="table-body">
              </tbody>
            </table>
          </div>
            
          
     



    
         
    

          
          

              
    </body>


<!-- Search-->
  




  <div id="logout"  style="display:none">

    <div class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50">
    <div class="bg-white dark:bg-zinc-800 rounded-lg shadow-lg w-11/12 sm:w-96 p-4">
        <div class="flex justify-between items-center border-b border-red-200 pb-2">
            <h2 class="text-red-600 dark:text-red-400 text-lg font-semibold">Log out</h2>
            <button class="text-zinc-600 dark:text-zinc-400 hover:text-zinc-800 dark:hover:text-zinc-200" id="changepassword"   >×</button>
        </div>
        <div class="flex items-center py-4">
            <img aria-hidden="true" alt="alert icon" src="../image/set-of-error-icon-information-logo-illustration-vector.png" height="80px" width="80px" class="rounded-full mr-4  " crossorigin="anonymous">
            <div>
                <h3 class="text-lg font-semibold text-red-600 dark:text-red-400">Are You Sure you want to logout?</h3>
                <p class="text-zinc-600 dark:text-zinc-300"></p>
            </div>
        </div>
        <div class="flex justify-end space-x-2 mt-4">
          <button  class="bg-white dark:bg-zinc-700 text-zinc-800 dark:text-zinc-300 border border-zinc-300 dark:border-zinc-600 rounded-lg py-2 px-4"  id="changepassword1"    >Cancel</button>
          <button class="bg-red-600 text-white rounded-lg py-2 px-4" id="confirm-logout" >Log me out</button>
          </div>
    </div>
</div>
</div>

<!--sidebar Notification-->
<div class="fixed top-0 right-0 flex items-center justify-center bg-white notification-panel" id="notification-panel">
  <div class="bg-card rounded-lg shadow-lg p-6 w-80">
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-lg font-semibold text-foreground">Notifications</h2>
      <button class="text-muted-foreground hover:text-muted close-button" id="close-button">×</button>
    </div>
    <div class="space-y-4">
      <div class="bg-white p-4 rounded-lg shadow-md">
        <h3 class="font-semibold">Text</h3>
        <p class="text-muted-foreground">Descriptions</p>
      </div>
      
    </div>
  </div>
</div>


 






<!-- Search-->

<!-- Firebase Function-->
 
<script src="https://cdn.firebase.com/libs/firebasejs/9.6.1/firebase-app.js" defer></script>
      <script src="https://cdn.firebase.com/libs/firebasejs/9.6.1/firebase-auth.js" defer></script>
      <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.1/firebase-app.js";
        import { getFirestore, collection, onSnapshot, getDocs, query, where,orderBy, limit } from "https://www.gstatic.com/firebasejs/9.1.1/firebase-firestore.js";
        import { getStorage, ref, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.1.1/firebase-storage.js";
        import { getAuth, sendEmailVerification } from "https://www.gstatic.com/firebasejs/9.1.1/firebase-auth.js";
        import { signInWithEmailAndPassword ,onAuthStateChanged,signOut} from "https://www.gstatic.com/firebasejs/9.1.1/firebase-auth.js";


const firebaseConfig = {
  apiKey: "AIzaSyCbWyVqhZdWL5tGF5Y2YXRpY5PJLC0ee6M",
  authDomain: "elibrarylogin-3d7e6.firebaseapp.com",
  projectId: "elibrarylogin-3d7e6",
  storageBucket: "elibrarylogin-3d7e6.appspot.com",
  messagingSenderId: "872832392728",
  appId: "1:872832392728:web:10489984713141407ded6d"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

        //logoutbutton on dashboard
     // Select the logout button and the modal
const logoutButton = document.getElementById('logoutbutton'); // assume this is the ID of the logout button
const logoutModal = document.getElementById('logout');

// Add an event listener to the logout button
logoutButton.addEventListener('click', function() {
    // Toggle the display property of the modal
    logoutModal.style.display = 'block'; // show the modal
});

// Add an event listener to the cancel button
document.getElementById('changepassword').addEventListener('click', function() {
    // Toggle the display property of the modal
    logoutModal.style.display = 'none'; // hide the modal
});

document.getElementById('changepassword1').addEventListener('click', function() {
    // Toggle the display property of the modal
    logoutModal.style.display = 'none'; // hide the modal
});

document.getElementById('confirm-logout').addEventListener('click', function() {
    signOut(auth).then(() => {
        // Clear browser history to prevent back button navigation
        window.location.href = '/logoutloading.html'; // Redirect to login page
        history.pushState(null, null, window.location.href); 
        window.onpopstate = function () {
            history.go(1);
        };
    }).catch((error) => {
        console.error('Error signing out:', error);
        alert('Error signing out. Please try again.');
    });
});

const auth = getAuth();

onAuthStateChanged(auth, (user) => {
    if (!user) {
        // User is not signed in, redirect to login page
        window.location.href = '/index.html'; // Redirect to login page
    }
});


  //logoutbutton on pop up
  


//search function







//notification function 
const notificationBell = document.getElementById('notificationbell');
const notificationPanel = document.getElementById('notification-panel');
const closeButton = document.getElementById('close-button');

// Hide notification on page load if it was closed previously
window.addEventListener('load', () => {
  if (localStorage.getItem('notificationClosed') === 'true') {
    notificationPanel.classList.remove('show'); // Hide the notification if it was closed before
  } else {
    notificationPanel.classList.add('show'); // Show the notification by default if not closed
  }
});

// Show the notification panel when the bell is clicked
notificationBell.addEventListener('click', () => {
  notificationPanel.classList.add('show'); // Show notification when bell is clicked
  localStorage.removeItem('notificationClosed'); // Reset the closed state if the bell is clicked
});

// Close the notification and mark it as closed in localStorage
closeButton.addEventListener('click', () => {
  notificationPanel.classList.remove('show'); // Close the notification
  localStorage.setItem('notificationClosed', 'true'); // Remember that the notification was closed
});

// Function to format the login time
function formatDate(dateString) {
  const options = {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
    hour: '2-digit',
    minute: '2-digit',
    second: '2-digit',
    hour12: true
  };
  const date = new Date(dateString);
  return date.toLocaleString('en-US', options); // You can adjust the locale if needed
}

// Function to fetch and display logs
async function fetchAndDisplayLogs() {
  try {
    // Reference to the 'userLogs' collection
    const querySnapshot = await getDocs(collection(db, "userLogs"));

    // Get the notification container
    const notificationContainer = document.getElementById("notifications-container");

    // Clear existing notifications
    notificationContainer.innerHTML = "";

    // Iterate through each document in the collection
    querySnapshot.forEach((doc) => {
      const data = doc.data();

      // Capitalize the first letter of the 'action' field
      const action = data.action ? data.action.charAt(0).toUpperCase() + data.action.slice(1) : "No Action";

      // Get the email field
      const email = data.email || "No Email";

      // Format the loginTime field
      const formattedTime = data.loginTime ? formatDate(data.loginTime) : "No Time";

      // Create a new notification element
      const notificationElement = document.createElement("div");
      notificationElement.className = "bg-white p-4 rounded-lg shadow-md";
      notificationElement.innerHTML = `
        <h3 class="font-semibold">${action}</h3>
        <p class="text-muted-foreground">${formattedTime}</p>
        <p class="text-muted-foreground">${email}</p>
      `;

      // Append the notification to the container
      notificationContainer.appendChild(notificationElement);
    });
  } catch (error) {
    console.error("Error fetching logs:", error);
  }
}

// Call the function to fetch logs and display notifications
fetchAndDisplayLogs();


//upload 
const usersRef = collection(db, 'users');
const inactiveStudentsRef = collection(db, 'inactiveStudents');
const tbody = document.querySelector('tbody');
const searchInput = document.getElementById('search-input');


onSnapshot(usersRef, async (snapshot) => {
  tbody.innerHTML = '';


  
  snapshot.docs.forEach((doc) => {
    const student = doc.data();
    let row = `
    <tr data-student-id="${doc.id}">
        <td class="p-2">${student.idNumber}</td>
        <td class="p-2">${student.firstname} ${student.middlename} ${student.lastname}</td>
        <td class="p-2">${student.gradeProgram}</td>

        <td class="p-2">${student.level}</td>
        <td class="p-2">${student.email}</td>
        <td class="p-2">${student.status}</td>
        

        
      </tr>
    `;
    tbody.innerHTML += row;
  });
});

const rows = tbody.rows;

searchInput.addEventListener('input', (e) => {
  const searchTerm = e.target.value.toLowerCase();
  for (let i = 0; i < rows.length; i++) {
    const row = rows[i];
    const cells = row.cells;
    let match = false;
    for (let j = 0; j < cells.length; j++) {
      const cell = cells[j];
      const cellText = cell.textContent.toLowerCase();
      if (cellText.includes(searchTerm)) {
        match = true;
        break;
      }
    }
    row.style.display = match ? '' : 'none';
  }
});



  







































//search function // // // // // // // //


window.onload = async function() {
    try {
        // Fetch and sort users
        const usersCollection = collection(db, 'users');
        const userSnapshot = await getDocs(usersCollection);
        const userDocs = userSnapshot.docs;

        const sortedUserDocs = userDocs.sort((a, b) => {
            const fullNameA = `${a.data().firstname} ${a.data().middlename} ${a.data().lastname}`;
            const fullNameB = `${b.data().firstname} ${b.data().middlename} ${b.data().lastname}`;
            return fullNameA.localeCompare(fullNameB);
        });

        // Fetch and sort books
        const booksCollection = collection(db, 'books');
        const bookSnapshot = await getDocs(booksCollection);
        const bookDocs = bookSnapshot.docs;

        const sortedBookDocs = bookDocs.sort((a, b) => {
            const titleA = a.data().title;
            const titleB = b.data().title;
            return titleA.localeCompare(titleB);
        });

        // Fetch and sort faculty members
        const facultyCollection = collection(db, 'faculty');
        const facultySnapshot = await getDocs(facultyCollection);
        const facultyDocs = facultySnapshot.docs;

        const sortedFacultyDocs = facultyDocs.sort((a, b) => {
            const emailA = a.data().email;
            const emailB = b.data().email;
            return emailA.localeCompare(emailB);
        });

        // Function to update the UI for users, books, and faculty members
        const updateUI = (searchTerm) => {
            const filteredUsers = sortedUserDocs.filter((doc) => {
                const fullName = `${doc.data().firstname} ${doc.data().middlename} ${doc.data().lastname}`;
                return fullName.toLowerCase().includes(searchTerm);
            });

            const filteredBooks = sortedBookDocs.filter((doc) => {
                const title = doc.data().title.toLowerCase();
                return title.includes(searchTerm);
            });

            const filteredFaculty = sortedFacultyDocs.filter((doc) => {
                const email = doc.data().email.toLowerCase();
                return email.includes(searchTerm);
            });

            // Update UI for users
            let hasUsers = false;
            for (let i = 1; i <= 3; i++) {
                const userNameElement = document.getElementById(`user${i}-name`);
                const userItemElement = userNameElement.parentElement; // Get the <li> element

                if (i <= filteredUsers.length) {
                    const data = filteredUsers[i - 1].data();
                    const fullName = `${data.firstname} ${data.middlename} ${data.lastname}`;
                    userNameElement.textContent = fullName;
                    userItemElement.style.display = ''; // Show the list item
                    hasUsers = true;
                } else {
                    userNameElement.textContent = '';
                    userItemElement.style.display = 'none'; // Hide the list item
                }
            }

            // Show or hide the Students section
            const studentsSection = document.getElementById('studentCollectiones');
            if (hasUsers) {
                studentsSection.style.display = ''; // Show the section if there are users
            } else {
                studentsSection.style.display = 'none'; // Hide the section if no users
            }

            // Update UI for books
            let hasBooks = false;
            for (let i = 1; i <= 3; i++) {
                const bookNameElement = document.getElementById(`book${i}-name`);
                const bookItemElement = bookNameElement.parentElement; // Get the <li> element

                if (i <= filteredBooks.length) {
                    const title = filteredBooks[i - 1].data().title;
                    bookNameElement.textContent = title;
                    bookItemElement.style.display = ''; // Show the list item
                    hasBooks = true;
                } else {
                    bookNameElement.textContent = '';
                    bookItemElement.style.display = 'none'; // Hide the list item
                }
            }

            // Show or hide the Books section
            const booksSection = document.getElementById('booksCollectiones');
            if (hasBooks) {
                booksSection.style.display = ''; // Show the section if there are books
            } else {
                booksSection.style.display = 'none'; // Hide the section if no books
            }

            // Update UI for faculty members
            let hasFaculty = false;
            for (let i = 1; i <= 3; i++) {
                const facultyNameElement = document.getElementById(`teachers${i}-name`);
                const facultyItemElement = facultyNameElement.parentElement; // Get the <li> element

                if (i <= filteredFaculty.length) {
                    const email = filteredFaculty[i - 1].data().email;
                    facultyNameElement.textContent = email;
                    facultyItemElement.style.display = ''; // Show the list item
                    hasFaculty = true;
                } else {
                    facultyNameElement.textContent = '';
                    facultyItemElement.style.display = 'none'; // Hide the list item
                }
            }

            // Show or hide the Faculty section
            const facultySection = document.getElementById('teachersCollectiones');
            if (hasFaculty) {
                facultySection.style.display = ''; // Show the section if there are faculty members
            } else {
                facultySection.style.display = 'none'; // Hide the section if no faculty members
            }
        };

        // Add event listener to the search input
        const searchInput = document.getElementById('search-input');
        searchInput.addEventListener('input', (e) => {
            const searchTerm = e.target.value.trim().toLowerCase();
            updateUI(searchTerm);
        });

        // Initial UI population with the first three users, books, and faculty members
        updateUI('');
    } catch (error) {
        console.error("Error fetching users, books, or faculty members: ", error);
    }
};

  </script>


</body>
</html>